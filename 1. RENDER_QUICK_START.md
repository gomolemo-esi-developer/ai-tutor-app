# TutorVerse Render Deployment - Quick Start

## Pre-Deployment (Local)

### 1. Prepare Your Code
```bash
# Make sure entrypoint script is committed
git add docker-entrypoint.sh
git add Dockerfile.frontend
git add RENDER_DEPLOY_SOLUTION.md
git add render.yaml
git commit -m "Prepare for Render deployment"
git push origin main
```

### 2. Verify Dockerfiles Build
```bash
docker build -f Dockerfile.rag .
docker build -f Dockerfile.backend .
docker build -f Dockerfile.frontend .
```

### 3. Gather Required Information
- ✅ OPENAI_API_KEY (for RAG service)
- ✅ GitHub repository URL
- ✅ Render account (create at https://render.com if needed)

---

## Deployment (Render Dashboard)

### Step 1: Deploy RAG Service
1. Go to https://dashboard.render.com
2. Click **New +** → **Web Service**
3. Select your GitHub repository
4. Fill in basic settings:
   - **Name**: `tutorverse-rag`
   - **Environment**: Docker
   - **Region**: `oregon` (or closest to you)
   - **Dockerfile Path**: `./Dockerfile.rag`
   - **Instance Type**: `Starter` ($12/month)

5. Scroll down to **Environment Variables** section and add:
   ```
   OPENAI_API_KEY=sk-xxxxxxxxxxxxx  (your OpenAI API key)
   ENVIRONMENT=production
   PYTHONUNBUFFERED=1
   CHROMA_PERSIST_DIR=/app/chroma_db
   ```

6. Click **Create Web Service**
7. **WAIT** for deployment to finish
8. Copy the service URL: `https://tutorverse-rag.onrender.com`

⏳ **5-10 minutes**

---

### Step 2: Deploy Backend Service
1. Click **New +** → **Web Service**
2. Select repository again
3. Fill in basic settings:
   - **Name**: `tutorverse-backend`
   - **Environment**: Docker
   - **Dockerfile Path**: `./Dockerfile.backend`
   - **Instance Type**: `Starter` ($12/month)

4. Scroll down to **Environment Variables** section and add:
   ```
   NODE_ENV=production
   AWS_REGION=us-east-2
   ENVIRONMENT=production
   RAG_SERVICE_URL=https://tutorverse-rag.onrender.com
   RAG_ENABLE=true
   RAG_TIMEOUT=30000
   RAG_RETRY_ATTEMPTS=3
   ```

5. Click **Create Web Service**
6. **WAIT** for deployment
7. Copy the URL: `https://tutorverse-backend.onrender.com`

⏳ **5-10 minutes**

---

### Step 3: Deploy Frontend Service
1. Click **New +** → **Web Service**
2. Select repository again
3. Fill in basic settings:
   - **Name**: `ai-tutor`
   - **Environment**: Docker
   - **Dockerfile Path**: `./Dockerfile.frontend`
   - **Instance Type**: Free

4. Scroll down to **Environment Variables** section and add:
   ```
   BACKEND_URL=https://tutorverse-backend.onrender.com
   NODE_ENV=production
   ```

5. Click **Create Web Service**
6. **WAIT** for deployment
7. Copy the URL: `https://ai-tutor.onrender.com`

✅ **You're done!**

---

## Post-Deployment Testing

### Open in Browser
Visit: `https://ai-tutor.onrender.com`

### Check Console
Open browser developer tools (F12):
- Network tab: API calls should go to `https://tutorverse-backend.onrender.com`
- Console: No CORS or connection errors

### Test APIs
```bash
# Backend health
curl https://tutorverse-backend.onrender.com/health

# RAG health
curl https://tutorverse-rag.onrender.com/health
```

### Check Service Logs
- Render Dashboard → Each service → **Logs** tab
- Look for errors or warnings

---

## Common Issues & Quick Fixes

| Issue | Solution |
|-------|----------|
| Frontend loads but no API calls | Check BACKEND_URL env var in frontend service |
| Backend/RAG won't start | Check logs in Render dashboard |
| Health checks failing | Increase start period: Settings → Health Check → 60s |
| Build takes >1 hour | Upgrade instance type to Standard |
| API calls return 502/504 | RAG service might be slow; check its logs |

---

## Production Use

### For Persistent Data
The RAG service needs persistent storage. Upgrade to Starter tier or add Render Disk:
- Dashboard → RAG service → Settings → Disk
- Add 10GB disk at `/app/chroma_db`

### Monitor Costs
- Frontend (Free): $0
- Backend (Starter): $12/month
- RAG (Starter): $12/month
- **Total: ~$24/month minimum**

---

## If Something Breaks

1. Check logs: Dashboard → Service → Logs
2. Redeploy: Dashboard → Service → Manual Deploy
3. Rollback: Dashboard → Service → Deployments → Click older one → Deploy

---

## What Was Changed

- ✅ Created `docker-entrypoint.sh` for dynamic nginx config
- ✅ Updated `Dockerfile.frontend` to use entrypoint
- ✅ Updated `render.yaml` with correct configuration
- ✅ All services use environment variables for inter-service communication
- ✅ No hardcoded localhost URLs (won't work on Render)

---

## Next Step

Push your code and follow **Deployment** section above!
